## LoadRunner教程


- LoadRunner教程
- 第 1 课：创建Vuser脚本
   - VuGen(VirtualUserGenerator)简介
   - 创建一个空Vuser脚本
   - 录制Vuser脚本
   - 查看Vuser脚本
      - 后续课程
- 第 2 课：回放Vuser脚本
   - 如何设置Vuser的运行时行为？
   - 如何运行我的Vuser脚本？
   - 何处可以查看有关回放的信息？
   - 如何知道脚本是否已成功回放？
   - 如何搜索或筛选回放结果？
      - 后续课程
- 第 3 课：解决常见回放失败问题
   - 设置HPWebTours，让其出现回放错误
   - 如何使用唯一的服务器值？
      - 后续课程
- 第 4 课：为负载测试准备Vuser脚本
   - 如何估计业务流程的持续时间？
   - 如何模拟多个用户？
   - 如何验证网页内容？
   - 如何生成调试信息？
   - 回放测试是否成功？
      - 后续课程
- 第 5 课：创建负载测试场景
   - LoadRunnerController简介
   - 如何启动Controller？
   - Controller一览
   - 如何修改脚本详细信息？
   - 如何在系统上生成负载？
   - 如何模拟真实负载行为？
   - 如何模拟不同类型的用户？
   - 如何监控负载下的系统？
      - 后续课程
- 第 6 课：运行负载测试
   - Controller运行视图一览
   - 如何运行负载测试场景？
   - 如何监控负载下的应用程序？
   - 如何实时观察Vuser的运行情况？
   - 在何处查看Vuser操作的摘要信息？
   - 如何在测试期间增加负载？
   - 应用程序在负载下如何运行？
   - 应用程序是否发生错误？
   - 如何知道场景已完成运行？
   - 系统在负载下是否正常运行？
      - 后续课程
- 第 7 课：分析场景
   - Analysis会话如何工作？
   - 如何启动Analysis会话？
   - Analysis窗口一览
   - 是否达到了我的目标？（服务水平协议）
   - 如何定义SLA？
   - 如何查看性能摘要？
   - 如何以图形方式查看性能？
   - 服务器的性能是否稳定？
   - 保存模板
   - 如何确定问题的根源？
   - 还可以收集哪些与场景运行情况相关的其他信息？
   - 如何发布结果？
   - 结论

**LoadRunner包含哪些组件？**

- VirtualUserGenerator ( VuGen )录制最终用户业务流程并创建自动性能测试脚本，也称为Vuser脚本。
- Controller 组织、驱动、管理并监控负载测试。
- Analysis 用于查看、剖析和比较负载测试结果。
- LoadGenerator 是运行Vuser以在系统上生成负载的计算机。

**LoadRunner术语**

| 术语          | 描述                                                         |
| ------------- | ------------------------------------------------------------ |
| 场景          | 基于性能要求定义测试会话期间发生的事件。                     |
| 虚拟用户Vuser | Vuser 模拟真实用户在系统上的操作。一个场景可以包含数十、数百乃至数千个Vuser |
| Vuser脚本     | 录制的在应用程序中执行的业务流程操作。                       |
| 协议          | 协议是客户端和服务器之间的通信方法。                         |
| 事务          | 您可以评测执行这些业务流程所用的时间。                       |
| 脚本占用      | 按照LoadGenerator上执行Vuser脚本所需的各种资源的数量定义。典型资源包括内存、CPU电源和磁盘空间。 |

**什么是LoadRunner负载测试流程？**
LoadRunner负载测试一般包括 5 个阶段：规划、脚本创建、场景定义、场景执行和结果分析。

1. **计划负载测试。** 定义性能测试要求，例如并发用户数量、典型业务流程和要求的响应时间。

2. **创建Vuser脚本。** 使用VuGen在自动化脚本中捕获最终用户活动。
3. **定义场景。** 使用Controller设置负载测试环境。
4. **运行场景。** 使用Controller驱动、管理并监控负载测试。
5. **分析结果。** 使用LoadRunnerAnalysis创建图和报告并评估系统性能。

**启动HPWebTours**

为说明用作负载测试解决方案的LoadRunner，本教程使用示例应用程序的性能要求。HPWebTours
示例应用程序是一个基于Web的旅行社系统。HPWebTours用户可以连接到Web服务器，搜索航
班，预订机票并查看航班路线。
虽然LoadRunner支持 50 多种类型的应用程序，但本教程仅演示了如何对基于Web的应用程序进行
负载测试。如果进行负载测试的应用程序不是基于Web，请联系HP以获取帮助。
在教程的这一节中，您将学习如何启动和登录到HPWebTours。

1. 启动示例Web服务器。
    在LoadRunner计算机上，选择 **开始>所有程序>HPSoftware>HPLoadRunner>Samples**
    **>Web>StartHPWebToursServer** 。在基于图标的桌面上（如Windows8），搜索 **"Start**
    **HP"** ，然后从结果中选择 **StartHPWebToursServer** 。
    此时将打开“StartWebServer”对话框。在访问WebTours应用程序时，将该对话框保持打开
    状态。
2. 打开HPWebTours。
    在LoadRunner计算机上，选择 **开始>所有程序>HPSoftware>HPLoadRunner>Samples**
    **>Web>HPWebToursApplication** 。在基于图标的桌面上（如Windows8），搜索 **"HP**
    **Web"** ，然后从结果中选择 **HPWebToursApplication** 。浏览器将打开并显示HPWebTours的
    主页。

注： 确保LoadRunner安装在计算机上的默认文件夹下。如果LoadRunner没有安装在默认文件夹下，将无法打开HPWebTours应用程序。（安装路径不含中文，空格，特殊符号）

3. 登录到HPWebTours。
    a. 输入以下信息：
       - Username： **jojo**
       - Password： **bean**
    b. 在左窗格中单击 **登录** 。将出现HPWebTours应用程序欢迎您使用的消息。
4. 预订机票。
    a. 在左窗格中单击 **Flights** 。将打开“FindFlight”页面。
    b. 将 **Arrivalcity** 更改为 **LosAngeles** 。
    c. 单击 **Continue** 。
    d. 在“FindFlight”页面上，接受默认航班选择并单击 **Continue** 。
    e. 在“PaymentDetails”页面上单击 **Continue** 。将显示“Invoice”页面，汇总航班预订情况。
5. 结束您的HPWebTours会话。
    在左窗格中单击 **SignOff** 退出。

**定义应用程序性能要求**

现在您已经熟悉了HPWebTours，假设您是负责检验HPWebTours是否满足业务需要的性能工程师。项目经理给您列出了 4 个发布条件：

1. HPWebTours必须能够成功处理 10 家旅行社的并发操作。
2. HPWebTours必须能够处理 10 个并发的机票预订操作，且响应时间不能超过 90 秒。
3. HPWebTours必须能够处理 10 家旅行社的并发航班路线查看操作，且响应时间不能超过 120
    秒。
4. HPWebTours必须能够处理 10 家旅行社的并发登录和注销操作，且响应时间不能超过 10 秒。
本教程将指导您完成检验每项业务需求的负载测试，使您清楚是否可以发布此应用程序。


## 第 1 课：创建Vuser脚本

要在系统上生成负载，首先需要创建可以运行以模拟真实用户行为的Vuser脚本。可以使用VuGen创建并生成Vuser脚本。

### VuGen(VirtualUserGenerator)简介

在性能测试环境中，LoadRunner用虚拟用户（也称为 Vuser ）代替真实用户。Vuser以一种可重复、可预测的方式模拟典型用户的操作，在系统上生成负载。
您可以使用VuGen（LoadRunner的VirtualUserGenerator）创建Vuser脚本。VuGen以“录制-回放”的方式工作。当您在应用程序中执行业务流程步骤时，VuGen会录制您的操作，并将这些操作转
换为Vuser脚本中的步骤。这些Vuser脚本构成了负载测试的基础。

### 创建一个空Vuser脚本

VuGen基于 Web-HTTP/HTML 协议。要创建一个空Vuser脚本，请执行以下操作：

1. 在LoadRunner计算机上，双击桌面上的 **VirtualUserGenerator** 快捷方式图标打开VuGen。
2. 单击 **文件>新建脚本和解决方案** 或单击VuGen工具栏上的 **添加新脚本** 按钮 。将打开“创建新脚本”对话框。


3. 确保 **类别** 为 **单协议** 。VuGen将列出适用于单协议脚本的可用协议。

4. 从可用协议的列表中，选择 **Web-HTTP/HTML** ，然后单击 **创建** 。VuGen将创建一个空Vuser脚本，并在VuGen编辑器中显示该脚本。

    ![image-20210308131524450](https://qwq.lsaiah.cn/picgo/20210308131524.png)

    ![image-20210308131543337](https://qwq.lsaiah.cn/picgo/20210308131543.png)

### 录制Vuser脚本

开发Vuser脚本的下一步是录制由实际用户执行的操作。在上一部分，您已创建一个空的 Web-HTTP/HTML Vuser脚本。现在可以开始将操作直接录制到脚本中。在本节中，您将跟踪旅行社预订从丹佛到洛杉矶的航班时所执行的操作，并查看航班路线。

要录制Vuser脚本，请执行以下操作：


1. 在HPWebTours网站上开始录制。

a. 单击 录制>录制 ，或单击VuGen工具栏上的 录制 按钮 。“开始录制”对话框将打开。

b. 在 录制到操作 框中，选择 操作 。
c. 从 录制 列表中选择 Web浏览器 。
d. 在 应用程序 框中，确保显示 MicrosoftInternetExplorer 。
e. 在 URL地址 框中，输入 http://127.0.0.1:1080/WebTours/ 。
f. 单击 开始录制 。这时将打开一个新的Web浏览器，并显示HPWebTours主页。这时将打开VuGen的浮动“录制”工具栏。

2. 登录到HPWebTours。
    a. 输入以下信息：
    
       - Username： **jojo**
       - Password： **bean**
    b. 在左窗格中单击 **登录** 。将出现HPWebTours应用程序欢迎您使用的消息。
    
3. 输入航班详细信息。
    a. 单击 **Flights** 。将打开“FindFlight”页面。
    b. 从 **DepartureCity** 中选择 **Denver** （默认值）。
    
    c. DepartureDate ：保持默认日期。
    d. 从 ArrivalCity 中选择 LosAngeles 。
    e. ReturnDate ：保持默认日期。
    f. 从 SeatingPreference 中选择 Aisle 。
    g. 请保持其余选项的默认设置不变并单击 Continue 。将打开“FindFlight”页面。

4. 选择航班。
    单击 **Continue** 接受默认航班选择。将打开“PaymentDetails”页面。
5. 输入支付信息并预订机票。
    a. 在 **CreditCard** 框中输入 **12345678** 。
    b. 在 **ExpDate** 框中输入 **06/19** 。
    c. 单击 **Continue** 。这时将打开发票页面，显示您的发票。
6. 在左窗格中单击 **Itinerary** 。这时将打开“Itinerary”页面。
7. 在左窗格中单击 **SignOff** 。
8. 关闭浏览器，然后单击VuGen浮动工具栏上的 **停止录制** 按钮 以停止录制。VuGen将生成所需的代码，并将在Vuser脚本中插入代码。如果设计工作室打开，请单击 **关闭** 以关闭设计工作室。
9. 保存Vuser脚本。
    a. 选择 **文件>将脚本另存为** 。
    b. 导航至 **<LoadRunner安装>\tutorial** ，创建名为 **Scripts** 的新文件夹，然后导航至新的**Scripts** 文件夹。
    c. 在 **文件名** 框中，输入 **basic_tutorial** 。
    d. 单击 **保存** 。VuGen将保存该脚本，并在VuGen标题栏中显示脚本名称。

### 查看Vuser脚本

现在您已经录制了旅行社登录、预订机票、查看航班线路和注销的操作。VuGen录制了从单击 开始录制 按钮到单击 停止录制 按钮之间的所有操作步骤。VuGen允许您以多种格式查看Vuser脚本：通过 解决方案资源管理器 。

要在步骤导航器中查看脚本，请选择 查看>步骤导航器 ，或单击VuGen工具栏上的 步骤导航器 按钮。双击步骤导航器中的任意步骤，以在编辑器中显示相应的函数。
VuGen 编辑器 显示基于文本的脚本视图。在编辑器中，Vuser的操作以API 函数的形式列出。在编辑器中，VuGen使用不同颜色标记来显示脚本中的函数及其参数值。您可以在脚本中直接输入C或LoadRunnerAPI函数以及控制流语句。


## 第 2 课：回放Vuser脚本

现在可以将录制的脚本合并到负载测试场景之前，回放此脚本以验证其是否能够正常运行。回放脚本前，必须为该脚本配置运行时设置，用于定义Vuser的行为。

### 如何设置Vuser的运行时行为？

通过LoadRunner运行时设置，可以模拟各种用户活动和行为。例如，可以模拟对服务器输出立即进行响应的用户，也可以模拟在每次响应之前停下来思考的用户。还可以配置运行时设置以指定Vuser重复Vuser脚本中一系列操作的次数。
有一般运行时设置和仅针对某些Vuser协议的设置。例如，对于Web仿真，可以指示Vuser在Firefox、Chrome或InternetExplorer中回放脚本。第 4 课将介绍特定协议的运行时设置。这一课将介绍一些一般运行时设置，即适用于所有Vuser协议的设置。一般运行时设置包括：

- 运行逻辑。 Vuser将重复Vuser脚本各部分的次数。
- 步。 两次重复之间的等待时间。
- 思考时间。 Vuser在脚本中的各步骤之间停下来思考的时间。
- 日志。 希望在回放期间收集的信息的级别。

要配置运行时设置，请执行以下操作：

1. 打开您在上一课中保存的Vuser脚本。

2. 打开“运行时设置”视图。
    单击 **回放>运行时设置** 或按F4。“运行时设置”视图将在VuGen编辑器中打开。
    
3. 设置“运行逻辑”设置。在左窗格中的 常规 下，单击 运行逻辑 。通过 运行逻辑 设置，您可以设置Vuser脚本的迭代次数。这是在回放脚本时，重复Vuser脚本的Action部分的次数。将 迭代次数 设置为 2 。

    ![image-20210308135145418](https://qwq.lsaiah.cn/picgo/20210308135145.png)

4. 配置步设置。在左窗格中的 常规 下，单击 步 。通过 步 设置，您可以控制迭代的间隔时间。可以指定一个随机时间。这样可以精确模拟用户在操作之间等待的实际设置，但使用随机时间间隔。例如，您看不到真实用户在重复操作之间始终等待 60 秒的情况。选择第三个单选按钮并选择下列设置：新迭代开始于随机间隔，每隔 60 到 90 秒 。

5. 配置日志设置。在左窗格中的 常规 下，选择 日志 。日志 设置指出要在运行Vuser脚本期间记录的信息量。开发Vuser脚本时，您可能要启用某些日志记录来调试脚本，但在确认脚本运行正常后，只能用于记录错误，甚至禁用日志记录功能。选择 扩展日志 并启用 参数替换 。后面的课程将对此选项展开进一步讨论。

6. 查看“思考时间”设置。在左窗格中的 **常规** 下，单击 **思考时间** 。保持默认思考时间设置- 忽略思考时间 。您可以在Controller中设置思考时间。注意，在VuGen中运行脚本时速度很快，因为它不包含思考时间。

### 如何运行我的Vuser脚本？

录制Vuser脚本并执行运行时设置后，就可以运行脚本。VuGen提供了您的脚本正在运行的许多指示器。

1. 消息“ **正在运行...** ”出现在VuGen的左下角。
2. 编辑器中出现一个黄色标记，表示正在回放的特定行。
3. “输出”窗格在回放时显示消息。

要运行Vuser脚本，请执行以下操作：

1. 在VuGen中打开Vuser脚本。
2. 单击 **回放>运行** 或单击VuGen工具栏上的 **回放** 按钮 。
    回放结束后，会出现一个消息框提示您是否扫描关联。单击 **否** 。


### 何处可以查看有关回放的信息？

当Vuser脚本停止运行后，您可以查看关于这次回放的摘要信息。回放摘要信息显示在 回放摘要 选项卡中。“回放摘要”选项卡列出关于脚本运行的基本信息，例如回放的持续时间、回放的开始和结束时间。此外，“回放摘要”选项卡还提供一个显示脚本事件日志的链接，以及一个显示脚本运行详细结果的链接。回放日志-在脚本回放期间所发生的事件的日志-显示在VuGen的“输出”窗格中。“输出”窗格使用不同颜色标记来显示回放期间所发生的事件的文本摘要。在教程的这一节，您将打开回放日志并找到日志内的特定事件和通知。

要查看回放日志，请执行以下操作：

1. 回放Vuser脚本后，单击 **视图>输出** 或单击VuGen工具栏上的 **输出** 按钮 。也可以单击“回放摘要”选项卡中的 **回放日志** 链接。
2. 确保在“输出”窗格中选择了 **回放** 。


3. 从VuGen菜单中单击 **搜索>快速查找** 以打开“搜索”对话框。
4. 从 **范围** 中选择 **当前脚本** 。
5. 单击 **在搜索中包含** ，然后选择 **日志** 复选框。
6. 使用“搜索”对话框查找“回放”日志中的以下项目：
    a. “虚拟用户脚本已启动”-脚本运行的开始。
    b. “Vuser已终止”-脚本运行的结束。
    c. “迭代”-每次迭代的开始和结束以及迭代次数。（该文本以橙色字体显示。）

注： “输出”窗格用绿色显示成功的步骤，用红色显示错误。例如，如果Vuser无法连接到服务器，则“输出”窗格将用红色显示错误文本，并指出脚本中发生错误的行号。

注： 如果双击“输出”窗格中的一行，VuGen将在VuGen编辑器中指示脚本中相应的步骤。

### 如何知道脚本是否已成功回放？

回放录制的事件后，需要查看回放结果以确定是否成功回放脚本。如果某个地方失败，则需要知道失败的时间以及原因。在这一节，您将查看并分析脚本运行结果。VuGen会在“测试结果”窗口中提供回放结果摘要信息。“测试结果”窗口首次打开时包含两个窗格：“树”窗格（左侧）和“结果摘要”窗格（右侧）。

- 树 窗格包含结果树。树中的每个迭代均已进行编号。

- 结果摘要 窗格包含关于脚本回放的详细信息以及屏幕录制器视频（如果有）。上表指出哪些迭代通过了测试，哪些未通过。如果Vuser按照原来录制的操作成功执行HPWebTours网站上的所有操
  作，则认为测试通过。下表指出哪些事务和检查点通过了测试，哪些未通过。稍后在本教程中您将把这些功能添加到测试中。

  要查看回放结果，请执行以下操作：

1. 单击 **回放摘要** 选项卡。
2. 单击 **回放>测试结果** 。“测试结果”窗口将打开并显示回放结果的摘要信息。在下一节，我们将深入研究回放结果，确定回放期间脚本是否能如期到达目标网页。


### 如何搜索或筛选回放结果？

如果回放结果指出有些地方失败，您可以深入分析测试结果并找出失败的地方。在“测试结果”窗口的“树”窗格中，可以展开测试树并分别查看每一步的结果。“摘要”窗格将显示迭代期间的回放快照。

1. 在树视图中展开迭代节点。

   a. 在结果树中，展开 basic_tutorialIteration 1 节点。
   b. 展开 ActionSummary 节点。展开的节点将显示这次迭代中执行的一系列步骤。

2. 显示结果快照。单击 **提交表单：login.pl** 节点。“摘要”窗格显示与该步骤相关的回放快照。
   
3. 查看步骤摘要。“摘要”窗格显示步骤摘要信息：对象或步骤名、关于页面加载是否成功的详细信息、结果（ **通**
    **过** 、 **失败** 、 **完成** 或 **警告** ）以及步骤执行时间。
    
4. 搜索结果状态。您可以使用关键字 **通过** 或 **失败** 搜索回放结果。
    此操作非常有用，例如当整个结果摘要表明回放失败时，您可以确定失败的位置。
    
    a. 要搜索回放结果，请选择 工具>查找 或单击“测试结果”工具栏上的 查找 按钮 。这时将打开“查找”对话框。
    
    b. 选择 通过 复选框，确保未选择其他选项，然后单击 查找下一个 。“测试树”窗格突出显示第一个状态为 通过 的步骤。

5. 筛选结果。可以筛选“测试树”窗格来显示特定的迭代或状态。例如，可以进行筛选以仅显示“失败”状态。

   a. 选择 视图>筛选 或单击“测试结果”工具栏上的 筛选器 按钮 。这时将打开“筛选器”对话框。

   b. 在 状态 下，选择 失败 并清除所有其他选项。
   c. 在 内容 下，选择 全部 并单击 确定 。因为没有失败的结果，所以左窗格为空。

6. 关闭“测试结果”窗口。单击 **文件>退出** 。


## 第 3 课：解决常见回放失败问题

创建Vuser脚本后，通过在VuGen中运行该脚本来对其进行验证。有时虽然操作录制成功，但回放却会失败。
许多应用程序都使用动态值，每次使用应用程序时这些值都会变化。例如，有些服务器会为每个新会话分配一个唯一的会话ID。尝试回放录制的会话时，应用程序创建的新会话ID与录制的会话ID不同。
动态值（例如这些唯一的会话ID）可能会在回放特定类型的Vuser脚本时带来困难。例如，动态会话ID在回放Web-HTTP/HTML脚本时常会带来问题，但在回放TruClient脚本时则不会。
LoadRunner使用关联解决动态值问题。关联将动态值（在本例中为会话ID）保存到参数中。运行Vuser脚本时，Vuser并不使用录制的值，而是使用服务器分配给它的新会话ID。
在这一课中，您将看到LoadRunner如何解决运行Web-HTTP/HTMLVuser脚本时遇到的动态值问题。

### 设置HPWebTours，让其出现回放错误

要演示常见的回放失败，您需要修改HPWebTours应用程序中的设置。此设置会通知HPWebTours服务器发出并索取唯一的会话ID。

1. 打开HPWebTours。
    在LoadRunner计算机上，选择 **开始>所有程序>HPSoftware>HPLoadRunner>Samples**
    **>Web>HPWebToursApplication** 。在基于图标的桌面上（如Windows8），搜索 **"HP Web"** ，然后从结果中选择 **HPWebToursApplication** 。浏览器将打开并显示HPWebTours的主页。
2. 更改服务器选项。
    a. 单击HPWebTours主页上的 **administration** （管理）链接。将打开Administration（管理）页面。
    b. 选中 **SetLOGINform'sactiontagtoanerrorpage** （将LOGIN表单的操作标记设置为错误页面）复选框。此设置告诉服务器不允许出现重复的会话ID。
    c. 向下滚动到页面底部并单击 **更新** 。
    d. 向下滚动到页面底部并单击 **返回到WebTours主页** 链接。

### 如何使用唯一的服务器值？

在修改后的HPWebTours配置中，服务器为每个Vuser分配一个唯一的会话ID。如果尝试回放在第1 课：创建Vuser脚本中录制的未做修改的Vuser脚本，则回放将失败。

为解决此问题，请使用VuGen检测是否需要关联会话ID。您可以让VuGen插入将原始会话ID保存到参数中这一步。在后续的每个回放会话中，VuGen都会将新的唯一会话ID保存到参数中。当Vuser执
行Vuser脚本中的步骤时，Vuser将使用保存的会话ID值，而不是原来录制的值。

1. 使用动态值录制新Vuser脚本。
    a. 按照之前在第 1 课：创建Vuser脚本(第 10 页)中录制的相同步骤录制新的Vuser脚本。
    b. 将脚本保存为 **basic_tutorial_Cor** 。
    
2. 回放新脚本。

    单击 回放>运行 或单击VuGen工具栏上的 回放 按钮 。VuGen将运行新Vuser脚本。您可能会注意到“输出”窗格的“回放日志”中有几条显示为红色的错误消息。
    回放结束后，会出现一个消息框提示您是否扫描关联。单击 否 。

3. 查看“回放摘要”。摘要中显示您的脚本回放失败。
4. 扫描脚本以查找需要关联的地方。
    选择 **设计>设计工作室** 。VuGen将扫描该脚本及其关联数据，用于搜索可能的动态值。设计工作室的“关联”选项卡将列
    出可能需要关联的几个动态值。这些值中最长的是会话ID。

5. 关联会话ID。
    a. 选择“关联”选项卡中的“会话ID”条目，然后单击 **关联** 。VuGen将“会话ID”的状态更改为 **已应用** ，并在Vuser脚本顶部插入新函数。新函数会将原始会话ID保存到参数中。在后续的每个回放会话中，VuGen都会将新的唯一会话ID保存到参数中。Vuser运行时，Vuser使用保存的ID值，而不是原来录制的值。
    b. 单击 **关闭** 关闭设计工作室。
    
6. 检查关联语句的语法。
    在VuGen编辑器中，找到VuGen添加到脚本中的语句。新语句看起来类似如下：
    
    ```
    web_reg_save_param_regexp(
    "ParamName=userSession",
    "RegExp=userSession\\value=(.*?)>\\n<table\\border",
    "SEARCH_FILTERS",
    "Scope=Body",
    "IgnoreRedirections=No",
    "RequestUrl=*/nav.pl*",
    LAST);
    ```
    
    该语句指示VuGen将正则表达式（唯一的会话ID）中第一次出现的值保存到名为 userSession的参数中。
    
7. 再次回放该脚本。

    a. 单击 回放>运行 或单击VuGen工具栏上的 回放 按钮 再次回放该脚本。回放结束后，在“输出”窗格中查找“回放日志”。请注意，VuGen不再发出用红色标识的错误消息。
    b. 单击 basic_tutorial_Cor.. 选项卡查看脚本代码。右键单击 web_reg_save_param_regexp并选择 转到回放日志中的步骤 。VuGen将光标放到回放日志中对应的行上。该日志表明函数
    web_reg_save_param_regexp 已成功，这说明关联已成功生效。

8. 重置HPWebTours服务器，忽略唯一的会话ID。
    a. 在LoadRunner计算机上，选择 **开始>所有程序>HPLoadRunner>Samples>Web>HP**
       **WebToursApplication** 以打开HPWebTours。在基于图标的桌面上（如Windows8），搜索 **"HPWeb"** ，然后从结果中选择 **HPWebToursApplication** 。
    b. 在HPWebTours主页上单击 **管理** 链接。
    c. 在 **管理** 页面中，取消选中 **将LOGIN表单的操作标记设置为错误页面** 复选框。
    d. 向下滚动到页面底部并单击 **更新** 。


## 第 4 课：为负载测试准备Vuser脚本

### 如何估计业务流程的持续时间？

在准备部署应用程序时，您需要估计具体业务流程的持续时间：登录、预订机票等要花费多少时间。每个业务流程通常由脚本中的一个或多个步骤或操作组成。在Vuser脚本中，通过将一系列操作包含在
事务 内，可以将它们指定为要评测的操作。
当运行包含事务的Vuser脚本时，LoadRunner会收集关于事务执行时间长度的信息，并将结果显示在用不同颜色标识的图和报告中。您可以使用这些信息帮助确定应用程序是否符合性能要求。
可以在Vuser脚本中的任意位置手动插入事务。要将一系列步骤标记为事务，请在第一个步骤前插入start_transaction 标记并在最后一个步骤后插入 end_transaction 标记。在这一节中，您将在脚本中插入一个事务来计算用户查找和确认航班所花费的时间。
要将事务插入到Vuser脚本中，请执行以下操作：

1. 在VuGen中，打开在第 1 课：中创建的 **Basic_Tutorial** 脚本。如果此脚本已经打开，可以选择显示其名称的选项卡。否则，可以从 **文件** 菜单中打开该脚本。

2. 单击 **步骤导航器** 选项卡显示步骤导航器。

3. 插入开始事务标记。
    a. 在步骤导航器中，找到步骤 **Image:SearchFlightsButton** 。
    b. 双击 **Image:SearchFlightsButton** 步骤以显示编辑器中相应的 **web_image** 步骤。
    c. 单击 **视图>步骤工具箱** 。步骤工具箱将显示在右窗格中。
    d. 在步骤工具箱中的 **常用** 下，选择 **lr_start_transaction** ，将其拖动到编辑器中，然后在 **web_image** 步骤前释放。“开始事务”对话框将打开。
    
    e. 在 事务名 框中，输入 find_confirm_flight 并单击 确定 。VuGen在步骤导航器中插入 lr_start_transaction 步骤，并在编辑器中插入相应的 lr_start_transaction 函数。

4. 插入结束事务标记。
    a. 在步骤导航器中，查找步骤 **提交数据：reservations.pl_ 2** 。
    b. 双击 **提交数据：reservations.pl_ 2** 步骤以显示编辑器中相应的 **web_submit_data** 步骤。
    c. 在步骤工具箱的 **常用** 下，选择 **lr_end_transaction** ，将其拖到编辑器中，然后在 **web_submit_data** 步骤后释放。“结束事务”对话框将打开。
    
    d. 确保 find_confirm_flight 显示在 事务名 框中，然后单击 确定 。VuGen在步骤导航器中插入lr_end_transaction 步骤，并在编辑器中插入相应的 lr_end_transaction 函数。


### 如何模拟多个用户？

在模拟场景中，跟踪一位预订机票并选择靠近过道座位的用户。但在实际生活中，不同的用户会有不同的喜好习惯。要改进测试，需要检查当用户选择不同的座位首选项（ 靠近过道 、 靠窗 或 无 ）时，是否可以正常预订。为此需要对脚本进行 参数化 。这意味着您要将录制的值 Aisle 替换为一个参数。将参数值放在参数文件中。运行脚本时，Vuser从参数文件中取值（ Aisle 、 Window 或 None ），从而模拟真实的旅行社环境。
要参数化脚本，请执行以下操作：

1. 找到要更改数据的部分。
    a. 选择 **视图>步骤导航器** ，以在左窗格中显示步骤导航器。
    b. 在步骤导航器中，找到 **提交数据:reservations.pl** 步骤。
    c. 右键单击 **提交表单：reservations.pl** 步骤并选择 **显示参数** 。将打开“提交表单步骤属性”对话框。网格中各个参数右侧的ABC图标 表示参数有一个固定值。
    
2. 将常量值更改为变量值

    a. 在“提交表单步骤属性”对话框中，选择网格第七行中的 seatPref

    b. 单击 seatPref 参数旁的 ABC 图标 。将打开“选择或创建参数”对话框。

3. 创建参数。

    a. 在 参数名称 框中，键入 seat 。
    b. 单击 确定 。在“提交表单步骤属性”对话框中，VuGen将 ABC 图标 替换为 参数 图标。

    c. 单击 {seat} 旁的 参数 图标 并选择 参数属性 。将打开“参数属性”对话框。

4. 指定参数的值。

    a. 单击 添加行 。VuGen将向表中添加行。

    b. 用 Window 替换 Value 。
    c. 单击 添加行 。VuGen将向表中添加另一行。

    d. 用 None 替换 Value 。

    e. 接受对话框的 选择列 和 文件格式 部分的默认设置。

5. 定义测试更改数据的方式。
    a. 接受默认设置，让VuGen为每次迭代取新值： **值更新时间:每次迭代** 。
    b. 单击 **关闭** 关闭“参数属性”对话框。
    c. 单击 **确定** 以关闭“提交表单步骤属性”对话框。现在已为座位首选项创建了参数。运行负载测试时，Vuser将使用参数值，而不是录制的值**Aisle** 。运行脚本时，回放日志会显示每次迭代发生的参数替换。Vuser第一次迭代将使用 **Aisle** ，第二次迭代将使用**Window** ，第三次迭代将使用 **None** 。

### 如何验证网页内容？

运行测试时，常常需要验证某些内容是否出现在返回的页面上。内容检查验证脚本运行时网页上是否出现期望的信息。可以插入两种类型的内容检查：

- 文本检查。 检查文本字符串是否出现在网页上。

- 图像检查。 检查图像是否出现在网页上。
  在这一节，您将插入文本检查，检查 FindFlight 是否出现在HPWebTours的Reservations（预订）页面上。

  插入文本检查：

1. 单击 **步骤导航器** 选项卡显示步骤导航器。

2. 在步骤导航器中，查找 **提交表单：reservations.pl** 步骤。

3. 在VuGen工具栏上，单击 **显示快照窗格** 按钮 以显示“快照”窗格。

4. 在步骤导航器中，双击快照图标，该图标位于 **提交表单：reservations.pl** 步骤。相应的快照将显示在“快照”窗格中。

5. 从VuGen菜单单击 **视图>步骤工具箱** 。此时将显示“步骤工具箱”窗格。

6. 在“步骤工具箱-搜索”框中，键入 **web_reg** ，然后在 **筛选结果** 中查找 **web_reg_find** 步骤。

7. 将 **web_reg_find** 步骤从工具箱拖到编辑器中 **web_submit_form** 函数的前面。此时将打开“查找文本”对话框。

8. 在“查找文本”对话框的 **搜索特定文本** 框中，键入 **FindFlight** ，然后单击 **确定** 。

9. VuGen在步骤导航器中插入 **web_reg_find** 步骤，并在编辑器中插入相应的 **web_reg_find** 函数。

    当回放脚本时，VuGen将查找文本 FindFlight 并在回放日志中指出是否找到该文本。

### 如何生成调试信息？

在测试运行过程中的某些时间点，您可能希望生成并发送包含脚本执行相关信息的消息。这些输出消息将同时显示在“输出”窗格的回放日志中及Controller的“输出”窗口中。可以发送标准输出消息或指出发生错误的消息。
要确定是否发出错误消息，建议先查找 失败 状态。如果状态为 失败 ，就让VuGen发出错误消息。有关详细信息，请参阅《HPLoadRunnerFunctionReference》中的示例。在教程的这一节中，您将指示VuGen在应用程序完成一次完整的预订后插入一条输出消息。要插入输出消息，请执行以下操作：

1. 单击 **步骤导航器** 选项卡显示步骤导航器。
2. 在步骤导航器中，找到最后一个步骤 **Image:SignOffButton** 。
3. 双击 **Image:SignOffButton** 步骤。编辑器将显示相应的 **web_image** 函数。
4. 在步骤工具箱中的 **常用** 下，找到 **lr_output_message** 函数。
5. 选择 **lr_output_message** 函数，将其拖动到编辑器中，然后在 **web_image** 函数后释放。将打开“输出消息”对话框。


6. 在“消息文本”框中，键入 **Theflightwasbooked** 。

7. 单击 **确定** 。VuGen会将 **lr_output_message** 添加到脚本中，并在步骤导航器中添加相应的步骤。

8. 单击VuGen工具栏上的 **保存** 按钮 以保存脚本。

    注： 要插入错误消息，可重复上述过程，不同之处在于要在步骤工具箱中选择 lr_error_message 函数而不是 lr_output_message 函数。

### 回放测试是否成功？

在这一节，您将运行增强的脚本并搜索回放日志来检查文本。将查看文本检查的结果，以及事务和参数化的详细信息。

默认情况下，由于图像和文本检查需要占用更多内存，在回放期间会将其禁用。如果要执行图像或文本检查，您需要在运行时设置中启用此项检查。

1. 启用图像和文本检查。

   a. 单击 回放>运行时设置 以打开“运行时设置”对话框。
   b. 单击 Internet协议>首选项 。
   c. 选择 启用图像和文本检查 。
   d. 单击 确认 关闭“运行时设置”对话框。

2. 运行脚本。

   单击VuGen工具栏上的 回放 按钮 。VuGen将开始运行脚本，同时在“输出”窗格的回放日志中生成条目。等待脚本完成运行。

2. 查找文本检查。
    a. 单击“输出”窗格并选择 **回放** 。
    b. 单击回放日志，然后按Ctrl+F打开“搜索”对话框。
    c. 查找 **web_reg_find** 。
       第一个实例如下：
    
    web_reg_find已启动
    
    单击 查找下一个 以显示 web_reg_find 的下一个实例。第二个实例如下：
    
    注册web_reg_find成功。
    
    这不是实际的文本检查，只是让VuGen准备好在表单提交后检查文本。单击 查找下一个 以显示 web_reg_find 的下一个实例。该实例如下所示：
    
    注册的web_reg_find对于“Text=FindFlight”成功(计数=1)。
    
    这说明文本已找到。如果有人更改了网页并删除了文字 FindFlight ，则在后续的运行中，输出消息会指示找不到该文本。
    
4. 查找事务的起始点。
    a. 在回放日志中，按Ctrl+F打开“搜索”对话框。
    b. 搜索单词 **Transaction** 。该通知用蓝色显示。
5. 查看参数替换。
    a. 在回放日志中，按Ctrl+F打开“搜索”对话框。
    b. 搜索单词 **Parameter** 。日志包含通知“ **seat** ”=“ **Aisle** ”。
    c. 再次搜索（按F3）下一处替换。注意VuGen在每次迭代时如何替换不同的值。
6. 选择 **文件>保存** 或单击VuGen工具栏上的 **保存** 按钮 。


## 第 5 课：创建负载测试场景

### LoadRunnerController简介

负载测试是指在典型工作条件下测试系统。例如，您可以在多家旅行社同时在同一个机票预订系统中预订机票时测试系统。

您需要设计测试来模拟真实情况。为此，您要能够在应用程序上生成负载，并安排向系统施加负载的时间（因为用户不会正好同时登录或退出系统）。您还需要模拟不同类型的用户活动和行为。例如，某些用户可能会使用Firefox访问系统，而其他用户使用InternetExplorer。用户还可能会使用不同的网络连接访问系统，例如调制解调器、DSL或电缆。您可以在场景中创建并保存这些设置。
Controller提供所有用于创建和运行测试的工具，帮助您准确模拟工作环境。

### 如何启动Controller？

要开始开发场景，请打开LoadRunnerController。

1. 打开HPLoadRunnerController。
    在LoadRunner计算机上，单击桌面上的 **Controller** 快捷方式图标。HPLoadRunnerController将打开并显示“新建场景”对话框。
    
2. 选择场景类型。

    通过 手动场景 可以控制正在运行的Vuser数目及其运行时间，另外还可以测试出应用程序可以同时运行的Vuser数目。您可以使用“百分比模式”，根据业务分析员指定的百分比在脚本间分配所有的Vuser。安装后首次启动LoadRunner时，默认选中“百分比模式”复选框。如果已选中该复选框，请取消选中。
    
    面向目标的场景 用来确定系统是否可以达到特定的目标。例如，您可以根据指定的事务响应时间或每秒点击数/事务数确定目标，然后LoadRunner会根据这些目标自动创建场景。单击手动场景 。
    
3. 向负载测试添加Vuser脚本。
    在本教程中，将仅使用一个Vuser脚本来模拟一组执行相同操作的用户。为了更精确地模拟具有更多种用户配置文件的真实场景，需要创建多个不同的Vuser组，各个组运行具有不同用户设置的多个脚本。
    先前在VuGen中录制的脚本包含要测试的业务流程。其中包括登录、搜索航班、购买机票、查看航班路线以及注销。您将向场景中添加类似的脚本，配置场景，模拟 8 家旅行社同时在机票预订系统中执行这些操作。测试期间将添加另外两个Vuser。
    为此我们提供了一个与您创建的脚本相类似的示例脚本。建议您使用这个示例脚本。
       a. 如果 **可用脚本** 窗格中已存在 **basic_script** ，请选中然后单击 **添加** 按钮以将脚本移动到 **场景中的脚本窗格。**
       b. 如果 **可用脚本** 窗格中不存在 **basic_script** ，请单击 **浏览** 按钮。在 **<LoadRunner安装 >\Tutorial** 文件夹中查找 **basic_script** 。单击 **打开** 。单击 **添加** 按钮以将脚本移动到 **场景中的脚本** 窗格。
    
    ​	c. 单击 确定 。LoadRunnerController将打开并显示新场景的 设计 选项卡。
    
    注：设计 选项卡的控件位于Controller的左下角。

### Controller一览

Controller的 设计 选项卡是用于设计负载测试的主界面。 设计 选项卡分为三个窗格：

1. **“场景组”窗格。** 可以在“场景脚本”窗格中配置Vuser组。您可以创建代表系统中典型用户的不同组，指定运行的Vuser数目以及运行时使用的计算机。
2. **“服务水平协议”窗格。** 设计负载测试场景时，可以为性能指标定义目标或SLA（服务水平协议）。运行场景时，LoadRunner收集并存储与性能相关的数据。分析运行情况时，Analysis将这些数据与SLA进行比较，并为预先定义的测量指标确定SLA状态。
3. **“场景计划”窗格。** 在“场景计划”窗格中，设置加压方式以准确模拟真实用户行为。可以根据Vuser将运行的操作、将负载施加到应用程序的速率、负载测试持续时间以及负载终止方式来定义操作


### 如何修改脚本详细信息？

1. 确保 **basic_script** 出现在 **场景组** 窗格的 **组名** 列中。

2. 更改 组名 。

   a. 在 场景组 窗格中，选择 basic_script ，然后单击 详细信息 按钮 。将打开“组信息”对话框。

   b. 在 组名 框中输入一个更有意义的名称，例如 travel_agent 。
   c. 单击 确定 。此新名称将显示在 设计 选项卡的 场景组 窗格中。

### 如何在系统上生成负载？

向场景添加Vuser脚本后，可以配置LoadGenerator（在系统上生成负载的计算机）。提示：定义 ：LoadGenerator是指为在系统上生成负载而运行多个Vuser的计算机。可以使用多个LoadGenerator，每个LoadGenerator托管多个Vuser。

在这一节，您将学习如何向场景添加LoadGenerator，以及如何测试LoadGenerator连接。添加LoadGenerator。

单击Controller工具栏上的 LoadGenerator 按钮 。LoadGenerator对话框打开。

通过“LoadGenerator”对话框，可以查看和配置在场景中定义的LoadGenerator。“LoadGenerator”对话框显示名为 localhost 的LoadGenerator的详细信息。 localhost LoadGenerator的状态为 关闭 。这说明Controller未连接到 localhost LoadGenerator。在本教程中，您将使用本地计算机作为LoadGenerator。

注： 在典型的运行系统中，您将有若干个LoadGenerator，每一个托管多个Vuser。

测试LoadGenerator连接。
运行场景时，Controller自动连接到LoadGenerator。但您也可以在运行场景之前测试连接。

1. 在“LoadGenerator”对话框中，选择 **localhost** ，然后单击 **连接** 。
    Controller会尝试连接到LoadGenerator计算机。建立连接后，LoadGenerator的 **状态** 会从 **关闭**变为 **就绪** 。
2. 单击 关闭 。

### 如何模拟真实负载行为？

添加LoadGenerator后，就可以配置加压方式。
典型用户不会正好同时登录和退出系统。LoadRunner允许用户逐渐登录和退出系统。它还允许您确定场景持续时间和场景终止方式。下面将要配置的场景相对比较简单。但在设计更准确地反映现实情况的
场景时，您可以定义更真实的Vuser活动。
您可以在Controller的 场景计划 窗格中为手动场景配置加载行为。“场景计划”窗格分为三部分： 计划定义 区域、 操作 单元格和 交互计划 图。现在您可以更改默认负载设置并配置场景计划。

1. 选择计划类型和运行模式。在 场景计划 窗格中，确保选中 计划方式:场景 和 运行模式:实际计划 。

2. 设置计划操作定义。

   您可以在 全局计划 网格或 交互计划 图中为场景计划设置 启动Vuser 、 持续时间 以及 停止Vuser 操作。在图中设置定义后， 全局计划 网格中的属性会相应调整。现在您可以设置定义，以便使 全局计划 网格显示如下。

   a. 设置Vuser初始化。
   初始化是指通过运行脚本中的 vuser_init 操作，为负载测试准备Vuser和LoadGenerator。
   根据系统配置，在Vuser开始运行之前进行初始化可以提供更加真实的结果。
   i. 在 全局计划 网格中双击 初始化 。这时将打开“编辑操作”对话框，显示 初始化 操作。

   ii. 选择 同时初始化所有Vuser 。
   iii. 单击 确定 。
   b. 对Vuser指定逐渐开始

   通过按照一定的间隔启动Vuser，可以让Vuser对应用程序施加的负载在测试过程中逐渐增加，帮助您准确找出系统响应时间开始变长的转折点。
   i. 在 全局计划 网格中双击 启动Vuser 。这时将打开“编辑操作”对话框，显示 启动Vuser操作。

   ii. 在 启动X个Vuser 框中，输入 8 并选择第二个选项： 2 个Vuser，每00:00:30 （30秒）。
   iii. 单击 确定 。
   c. 计划持续时间。
   您可以指定持续时间，确保Vuser在特定的时间段内持续执行计划的操作，以便评测服务器上的持续负载。如果设置了持续时间，脚本会运行这段时间内所需的迭代次数，而不考虑脚本的运行时设置中所设置的迭代次数。

   i. 通过单击交互计划图工具栏上的 编辑模式 按钮 确保交互计划图处于编辑模式。
   ii. 在交互计划图中，单击代表持续时间的水平线。这条水平线会突出显示并且在端点处显示点和菱形。

   注： 如果菱形的顶端显示了图例，请单击交互计划图工具栏上的 隐藏图例 按钮 显示菱形。

   iii. 将菱形端点向右拖动，直到括号中的时间显示为 00:11:30 。您刚才已设置Vuser运行10 分钟。
   d. 计划逐渐关闭。
   建议逐渐停止Vuser，以帮助在应用程序到达阈值后，检测内存漏洞并检查系统恢复情况。
   i. 在 全局计划 网格中双击 停止Vuser 。这时将打开“编辑操作”对话框，显示 停止Vuser操作。

   ii. 选择第二个选项并输入以下值： 2 个Vuser，每00:00:30 （30秒）。
   iii. 单击 确定 。

### 如何模拟不同类型的用户？

现在已配置好负载计划，接下来需要指定Vuser在测试期间的行为方式。
模拟真实用户时，需要考虑用户的实际行为。行为是指用户在操作之间暂停的时间、用户重复同一操作的次数，等等。
在这一节，您将进一步了解LoadRunner的运行时设置，并启用思考时间和日志记录。

1. 打开运行时设置。
    a. 在Controller中，单击 **设计** 选项卡。
    b. 在 **场景组** 窗格中，选择 **travel_agents** 组。
    c. 单击“场景组”工具栏上的 **运行时设置** 按钮 。“运行时设置”对话框将打开。

通过运行时设置：可以模拟各种用户活动和行为。其中包括：

运行逻辑： Vuser重复一系列操作的次数。

步：重复操作之前等待的时间。
日志： 希望在测试期间收集的信息的级别。如果是首次运行场景，建议生成日志消息，确保万一首次运行失败时有调试信息。
思考时间： 用户在各步骤之间停下来思考的时间。由于用户是根据其经验水平和目标与应用程序交互，因此，技术上更加精通的用户工作速度可能会比新用户快。通过启用思考时间，可使Vuser在负载测试期间更准确地模拟对应的真实用户。
速度模拟：使用不同网络连接（例如调制解调器、DSL和电缆）的用户。
浏览器模拟： 使用不同浏览器查看应用程序性能的用户。
内容检查：用于自动检测用户定义的错误。
假设发生错误时应用程序发送了一个自定义页面。该自定义页面总是包含文字“ASP错误”。您需要搜索服务器返回的所有页面，并查看是否出现文本“ASP错误”。您可以使用“内容检查”运行时设置，设置LoadRunner在测试运行期间自动查找这些文字。LoadRunner将搜索这些文字并在检测到时生成错误。在场景运行期间，您可以识别内容检查错误。

2. 启用思考时间。
    a. 在“运行时设置”对话框中，单击 **常规>思考时间** 。
    b. 选择 **重播思考时间** ，并选择 **使用录制思考时间的随机百分比** 
    c. 指定最小值为 **50%** ，最大值为 **150%** 。

以上规范使用录制思考时间的随机百分比模拟熟练程度不同的用户。例如，如果选择航班的录制思考时间是 4 秒，则随机时间可以是 2 - 6 秒之间的任意值（4的50%至150%）。

 3. 启用日志记录。

    ​	a. 在“运行时设置”对话框中，单击 常规>日志 。
    ​	b. 选择 启用日志记录 。
    ​	c. 在 日志选项 下，选择 始终发送消息 。
    ​	d. 单击 扩展日志 ，然后选择 服务器返回的数据 。注： 初次调	试运行后，建议不要对负载测试使用扩展日志记录。在本教程中	启用它只是为了提供Vuser输出日志信息。

    ​	e. 保存场景。

### 如何监控负载下的系统？

现在已经定义了Vuser在测试期间的行为方式，接下来就可以设置监控器了。
在应用程序上生成负载时，您希望实时了解应用程序的执行情况以及潜在的瓶颈。使用LoadRunner的一套集成监控器可以评测负载测试期间系统每一层的性能以及服务器和组件的性能。LoadRunner包含多种后端系统主要组件（如Web、应用程序、数据库和ERP/CRM服务器）的监控器。
例如，您可以根据正在运行的Web服务器类型选择Web服务器资源监控器。还可以为相关的监控器购买许可证，例如IIS，然后使用该监控器精确指出IIS资源中反映的问题。
在这一节，您将学习如何添加和配置Windows资源监控器。您可以使用该监控器确定负载对CPU、磁盘和内存资源的影响。

1. 选择Windows资源监控器。
    a. 单击Controller底部的 **运行** 选项卡。
       Windows资源图是显示在图查看区域的四个默认图之一。在下一课您将学习如何打开其他图。

    b. 右键单击“Windows资源”图并选择 添加度量 。此时将打开“Windows资源”对话框。

2. 选择监控的服务器。

    a. 在“Windows资源”对话框的 监控的服务器计算机 部分，单击 添加 。“添加计算机”对话框打开。

    b. 在 名称 框中，输入 localhost 。（如果LoadGenerator正在另一台计算机上运行，您可以键入服务器名称或该计算机的IP地址。）
    c. 从 平台 列表中，选择计算机的运行平台。
    d. 单击 确定 。
    默认的Windows资源度量列在 <服务器计算机>上的资源度量下

3. 激活监控器。单击“Windows资源”对话框中的 确定 以关闭对话框并激活监控器。


## 第 6 课：运行负载测试

### Controller运行视图一览

Controller中的“运行”选项卡是用来管理和监控场景的控制中心。 运行 选项卡（位于Controller窗口的下半部分）包含五个窗格：

1. **“场景组”窗格。** 位于左上角的窗格，您可以在其中查看场景组内Vuser的状态。使用该窗格右侧的按钮可以启动、停止和重置场景，查看各个Vuser的状态，通过手动添加更多Vuser增加场
    景运行期间应用程序的负载。
2. **“场景状态”窗格。** 位于右上角的窗格，您可以在其中查看负载测试的摘要信息，包括正在运行的Vuser数量和每个Vuser操作的状态。
3. **“可用图”窗格。** 位于中间偏左位置的窗格，您可以在其中看到一列LoadRunner图。要打开图，请在树中选择一个图，并将其拖到图查看区域。
4. **“图显示”窗格** 。在中间偏右位置的窗格中，您可以在其中自定义显示画面，查看 1 到 8 个图
    （ **视图>查看图** ）。
5. **“图例”窗格。** 位于底部的窗格，您可以在其中查看所选图的数据。注： “运行”选项卡控件位于Controller底部。

### 如何运行负载测试

1. 打开Controller的“运行”视图。
    单击Controller底部的 **运行** 选项卡。
    请注意， **场景组** 窗格的 **关闭** 列中有 8 个Vuser。这些Vuser是在创建场景时创建的。
    
    由于尚未运行场景，所有其他计数器均显示为零，并且图查看区域内的所有图（Windows资源除外）都为空白。在下一步开始运行场景之后，图和计数器将开始显示信息。
    
2. 开始场景。
    单击 **开始场景** 按钮，或选择 **场景>开始** 以开始运行场景。
    如果您是第一次运行测试，Controller将开始运行场景。结果文件将自动保存到LoadGenerator的 **temp** 文件夹下。
    如果您是重复测试，系统会提示您覆盖现有的结果文件。单击 **否** ，因为首次负载测试的结果应该作为基准结果，用来与后面的负载测试结果进行比较。“设置结果目录”对话框打开。指定新的结果文件夹。为每个结果集输入一个唯一且有意义的名称，因为在分析图时您可能要将几次场景运行的结果重叠。

### 如何监控负载下的应用程序？

您可以使用Controller的联机图来查看监控器收集的性能数据。使用这些信息确定系统环境中可能存在问题的区域。

1. 检查性能图。
    “运行”选项卡的“图显示”窗格显示下列默认的图：
       a. **“正在运行Vuser-整个场景”图。** 显示在指定时间运行的Vuser数。
       b. **“事务响应时间-整个场景”图。** 显示完成每个事务所用的时间。
       c. **“每秒点击次数-整个场景”图。** 显示场景运行期间Vuser每秒向Web服务器提交的点击次数（HTTP请求数）。
       d. **“Windows资源”图。** 显示场景运行期间评测的Windows资源。
    
2. 突出显示单个测量值。

    a. 双击“Windows资源”图将其放大，以整个适合“图显示”窗格。请注意，各个测量值将显示在“图例”窗格中用不同颜色标记的行中。每行对应图中与之颜色相同的一条线。
    b. 选中一行以突出显示图中的相应线条，反之则不突出显示。
    c. 再次双击图将其缩小。

3. 查看吞吐量信息。
    在“可用图”窗格中，在 **Web资源图** 下选择 **吞吐量** 图，然后将其拖动到“图显示”窗格。“吞吐量”图中的测量值显示在“图显示”窗格和“图例”窗格中。“吞吐量”图显示Vuser每秒从服务器接收的数据量（以字节为单位）。您可以将此图与“事务响应时间”图比较，查看吞吐量对事务性能的影响。
    如果随着时间的推移和Vuser数目的增加，吞吐量不断增加，说明带宽够用。如果随着Vuser数目的增加，吞吐量保持相对平稳，可以认为是带宽限制了数据流量。

### 如何实时观察Vuser的运行情况？

模拟用户时，您应该能够实时查看Vuser的操作，确保它们执行的操作正确。通过Controller，可以使用运行时查看器实时查看操作。
要直观地查看Vuser的操作，请执行以下操作：

1. 在Controller的 **运行** 选项卡中，单击 **Vuser** 按钮。Vuser对话框将打开。

   状态 列显示每个Vuser的状态。在上例中，可以看到有四个Vuser正在运行，四个Vuser已经关闭。计划程序中的“启动Vuser”操作指示Controller每次释放两个Vuser。随着场景的运行，将继续每隔 30 秒向组中添加两个Vuser。

2. 从Vuser列表中选择一个正在运行的Vuser。
3. 单击Vuser工具栏上的 **显示选定的Vuser** 按钮 。将打开运行时查看器并显示所选Vuser执行的操作。随着Vuser执行Vuser脚本中所包含的各个步骤，运行时查看器将不断更新。
4. 单击Vuser工具栏上的 **隐藏选定的Vuser** 按钮 ，关闭运行时查看器。


### 在何处查看Vuser操作的摘要信息？

对于正在运行的测试，要查看测试期间各个Vuser的进度，可以显示包含Vuser操作文本摘要信息的日志文件。
要查看Vuser操作的文本摘要信息，请执行以下操作：

1. 在Vuser窗口中，选择正在运行的Vuser。
2. 单击Vuser工具栏上的 **显示Vuser日志** 按钮。“Vuser日志”对话框将打开。日志中包含与Vuser操作对应的消息。例如，在上面的窗口中，消息 Virtual User Script started说明Vuser运行已启动。滚动到日志底部，查看为Vuser执行的每个操作添加的新消息。
3. 关闭“Vuser日志”对话框和“Vuser”对话框。

### 如何在测试期间增加负载？

在负载测试期间可以手动添加更多Vuser，以增加系统负载。

1. 要在负载测试期间增加负载，请执行以下操作：
    a. 确保在Controller中显示 **运行** 选项卡
    b. 单击 **运行/停止Vuser** 按钮。“运行/停止Vuser”对话框将打开，显示当前分配的要在场景中运行的Vuser数。
    
    c. 在 # 列中，输入要添加到组中的Vuser数。要运行另外两个Vuser，请在 # 列中将数字 8 替换为数字 2 。
    d. 单击 运行 以添加Vuser。
    e. 如果某些原始Vuser尚未初始化，将出现 运行已初始化的Vuser 和 运行新Vuser 选项。选择运行新Vuser 选项。
    
    这两个额外的Vuser将分配给 travel_agent 组并在 localhost LoadGenerator上运行。“场景状态”窗格显示现在有 10 个正在运行的Vuser。
    
    注： 您可能会收到警告消息，指出LoadRunnerController无法激活额外的Vuser。
    这是由于您使用本地计算机作为LoadGenerator，而该计算机的内存资源有限。通常使用专用计算机作为LoadGenerator来避免出现该问题。

### 应用程序在负载下如何运行？

在“运行”选项卡上的“场景状态”窗格中查看正在运行的场景的摘要。在“场景状态”窗格中，您可以向下搜索以查看引起应用程序问题的Vuser操作。过多的失败事务和错误说明应用程序在负载下的运行情况没有达到所需要求。

1. 查看场景状态。
    “场景状态”窗格的标头显示场景的整体状况。


2. 查看Vuser操作的详细信息。
    a. 单击“场景状态”窗格中的 **通过的事务** 。“事务”对话框将打开，显示事务的详细信息列表。
    
    b. 单击 关闭 可关闭“事务”对话框。

### 应用程序是否发生错误？

如果应用程序在重负载下启动失败，可能是出现了错误和失败的事务。Controller将在输出窗口中显示错误消息。

1. 检查是否存在错误消息或警告消息。
    a. 选择 **视图>显示输出** 。您可以按照类型对消息进行排序，例如 **警告** 或 **错误** 。“输出”对话框将打开，列出消息文本、生成的消息总数、发生错误的Vuser和LoadGenerator以及发生错误的脚本。
    
    b. 要查看消息的详细信息，请选择该消息并单击 详细信息 。将打开“详细信息文本”框，显示完整的消息文本。
    
2. 查看详细的日志信息。
    您可以单击相应列中的蓝色链接以查看与错误代码相关的每个消息、Vuser、脚本和LoadGenerator。
    例如，要确定脚本中发生错误的位置，请向下搜索“消息总数”列中的详细信息。“输出”窗口显示所选错误代码的所有消息列表，包括时间、迭代次数和脚本中发生错误的行。
3. 向下搜索“行号”列。
    打开VuGen，显示脚本中发生错误的行。您可以使用这些信息找出响应速度比较慢的事务，它们导致应用程序在负载下运行失败。

### 如何知道场景已完成运行？

场景运行结束时，“场景状态”窗格的标头将显示 关闭 状态。这表示场景中的所有Vuser运行结束。

您可以打开Vuser对话框以查看每个Vuser的状态。Vuser对话框显示每个Vuser执行的迭代次数、成功迭代的次数以及已用时间。


### 系统在负载下是否正常运行？

要了解系统在负载下的运行情况，请查看事务响应时间并确定响应时间是否在可接受的范围内。如果场景运行期间的事务响应时间增加，则需要找出瓶颈。

找出问题后，需要各方的共同努力来解决问题，包括开发人员、DBA、网络以及其他系统专家。调整后，再次运行负载测试来确认所做的调整是否达到了预期效果。重复此循环以优化系统性能。要保存场景以便再次使用相同的设置运行它，请选择 文件>保存 或单击Controller工具栏上的 保存 按钮 。


## 第 7 课：分析场景

在前面的课程中，您已学习了如何设计场景、执行场景以及如何控制场景的执行。在服务器上施加负载后，需要分析运行情况，并确定需要解决哪些问题来提高系统性能。

### Analysis会话如何工作？

Analysis会话的目的是查找系统的性能问题，然后找出这些问题的根源，例如：

- 是否达到了预期的测试目标？在负载下，对用户终端的事务时间是多少？是符合SLA还是偏离了目标？事务的平均事务时间是多少？
- 系统的哪些部分导致了性能下降？网络和服务器的时间是多少？
- 通过将事务时间与后端监控器矩阵表关联在一起，能否找出可能的原因？

### 如何启动Analysis会话？

1. 打开HPLoadRunnerAnalysis。
    在LoadRunner计算机上，双击桌面上的 **Analysis** 图标。这时将打开LoadRunnerAnalysis。
2. 打开Analysis会话文件。

    为了配合本教程中的这一部分，说明更多不同的结果，我们运行了一个与您在前面课程中所运行的场景相似的场景。但是这次场景使用了 70 个Vuser，而不是 10 个。现在您可以打开使用此场景的结果所创建的Analysis会话。
    a. 在Analysis窗口中选择 文件>打开 。此时将打开“打开Analysis会话”对话框。

    b. 从 <LoadRunner安装>\tutorial 文件夹选择 analysis_session 并单击 打开 。Analysis将打开会话文件。

### Analysis窗口一览

Analysis包含下列主要窗格：

1. 会话浏览器

2. “属性”窗格

3. “图查看”窗格

4. “图例”窗格

   **会话浏览器。** 位于左上方的窗格，Analysis在其中显示已经打开可供查看的报告和图。您可以在
   此处显示打开Analysis时未显示的新报告或图，或者删除自己不想再查看的报告或图。

   **“属性”窗格。** 位于左下方的窗格，“属性”窗格显示您在会话浏览器中选择的图或报告的详细
   信息。黑色字段是可编辑字段。

   **“图查看”窗格。** 位于右上方的窗格，Analysis在其中显示图。默认情况下，打开会话时，摘要
   报告将显示在此区域。

   **“图例”窗格。** 位于右下方的窗格，在此窗格内，您可以查看所选图中的数据。

   注： 存在可从工具栏进行访问的其他窗格。可以在屏幕上随意拖放这些窗格。

### 是否达到了我的目标？（服务水平协议）

在这一节，我们将介绍服务水平协议（或称SLA）。

SLA是您为负载测试场景定义的具体目标。Analysis将这些目标与LoadRunner在运行过程中收集和存储的性能相关数据进行比较，然后确定目标的SLA状态（ 通过 还是 失败 ）。例如，可以定义具体的目标或阈值，用于评测脚本中事务的平均事务时间。测试运行结束之后，LoadRunner会将您定义的目标与实际录制的平均事务时间进行比较。Analysis显示每个所定义SLA的状态（ 通过 或 失败 ）。例如，如果实际的平均事务时间未超过您定义的阈值，SLA状态将为 通过 。作为目标定义的一部分，您可以指示SLA将负载条件考虑在内。这意味着可接受的阈值将根据负载级别（例如， 运行的Vuser数 、 吞吐量 等）而有所更改。随着负载的增加，您可以允许更大的阈值。根据定义的目标，LoadRunner将以下列某种方式来确定SLA状态：

- 通过时间线中的时间间隔确定SLA状态。 在运行过程中，Analysis按照时间线上的预设时间间隔（例如，每 5 秒钟）显示SLA状态。

- 通过整个运行确定SLA状态。 Analysis为整个场景运行显示一个SLA状态。可以在Controller中运行场景之前定义SLA，也可以稍后在Analysis中定义SLA。在下一节中，您将使用HPWebTours示例定义SLA。假设HPWebTours的管理员想要了解 book_
  flight 和 search_flight 事务的平均事务时间何时会超过既定值。为此，请选择相应事务，然后设置阈值。这些阈值是可接受的平均事务时间最大值。您还将设置这些阈值，将具体的负载条件考虑在内；在本例中为正在运行的Vuser数。换句话说就是，随着正在运行的Vuser数目的增加，阈值将增大。这是因为，尽管HPWebTours管理员希望平均事务时间尽可能短，但我们都知道每年的一些特定时候可以合理地假定HPWebTours网站的负载比其他时候高。例如，在旅游旺季，会有更多的旅行社登录到网站来预订机票、查看航班路线，等等。在这种合理的重负载情况下，平均事务时间稍长也可以接受。您将设置SLA，将三种负载情况都考虑在内：轻负载、平均负载和重负载。每个场景将有各自的阈值。

### 如何定义SLA？

运行场景后，将在Analysis中定义SLA。

注： 最好是在运行场景之前在Controller中定义SLA。由于您没有分析前面课程中运行的测试场景，因此为了实现本教程的教学目的，将在Analysis中定义SLA。要在Controller中定义SLA，请在 设计 选项卡的 服务水平协议 部分单击 新建 。

现在您将定义一个SLA，该SLA将为示例会话文件中的 book_flight 和 search_flight 事务设置平均事务时间的具体目标。在运行过程中，将按设定的时间间隔评测平均事务时间。

要定义SLA，请执行以下操作：

1. 打开SLA向导。

   a. 在LoadRunnerAnalysis中，选择 工具>配置SLA规则 。“服务水平协议”对话框打开。

   b. 单击 新建 打开“服务水平协议”向导。

   注： 初次打开“服务水平协议”向导时，将显示 开始 页。如果不希望在下次运行向导时显示该页面，请选中 下次跳过该页面 复选框。

   c. 单击 下一步 。

   2. 为目标选择度量。

      a. 在“选择目标度量”页面中选择 事务响应时间:平均 。

      b. 单击 下一步 。

      3. 选择要监控的事务。
         在“选择事务”页面中，从 **可用事务** 列表选择要监控的事务。
          a. 双击 **check_itinerary** 事务将其移到 **选定事务** 列表中。

      b. 单击 下一步 。

   4. 设置加载条件。

      在“设置加载条件”页面，可以指示SLA将不同的加载条件考虑在内。

      ​	a. 从 加载条件 下拉列表中选择 正在运行的Vuser数 。
      ​	b. 将 加载值 设置为和以下示例类似：

      在以上屏幕中，您设置了SLA以定义以下三种潜在负载场景的可接受的平均事务时间：

- **轻负载。** 有 0 至 19 个Vuser
- **平均负载。** 有 20 至 49 个Vuser
- **重负载。** 超过 50 个Vuser
c. 单击 **下一步** 。
5. 设置阈值。
在“设置阈值”页面中，您将为 **check_itinerary** 事务定义可接受的平均事务时间。将阈值设置为和以下示例类似：

您仅指示以下平均事务时间是可接受的：

- 轻负载。 5 秒以内

- 平均负载。 10 秒以内

- 重负载。 15 秒以内
  6. 保存SLA。

要保存SLA并关闭向导，可以在后续网页中依次单击 Next （前进）、 Finish （完成）和 Close（关闭）。
Analysis将您的SLA设置应用于摘要报告。然后更新报告以包含所有相关的SLA信息。

### 如何查看性能摘要？

“摘要报告”选项卡显示关于场景运行情况的常规信息和统计信息，另外还提供所有相关的SLA信息。例如，按照所定义的SLA，执行情况最差的事务是哪些，如何按照设定的时间间隔执行特定的事务以及整体SLA状态。可以从会话浏览器打开摘要报告。

1. 场景的总体统计信息

在“统计信息摘要表”部分，您可以看到这次测试最多运行了 70 个Vuser。另外此处还显示了其他统计信息，例如总吞吐量/平均吞吐量以及总点击数/平均点击数。

2. 执行情况最差的事务“5个最差事务”表最多可显示五个定义了SLA且执行情况最差的事务。

您可以看到在 check_itinerary 事务持续时间内，该时间超过了SLA阈值66.4%。整个运行期间，它超出SLA阈值的平均百分比为200.684%。

3. 超出SLA阈值的时间间隔

“随时间变化的场景行为”部分显示不同的时间间隔内各个事务的执行情况。绿色方块表示事务在SLA阈值范围内执行的时间间隔，红色方块表示事务失败的时间间隔，灰色方块表示尚未定义相关的SLA。您可以看到对于为其定义SLA的事务， check_itinerary 的大部分时间间隔均超过了阈值。

4. 事务的整体性能“事务摘要”列出每个事务的摘要情况。

我们也可以看到 check_itinerary 事务已失败了 28 次。
查看每个事务的时间。值为 90% 的列表示时间占特定事务执行时间的90%。您可以看到在测试运行期间执行的 check_itinerary 事务中有90%的时间为65.754秒。这是其平均时间32.826秒的 2 倍，这意味着此事务发生时响应时间通常很长。注意 SLA状态 列如何显示SLA中相关的事务整体状态： check_itinerary 的状态是 失败 。

### 如何以图形方式查看性能？

可以从“会话浏览器”窗格访问可用图。现在您将查看并分析“平均事务响应时间”图。

1. 打开“平均事务响应时间”图。

a. 在 图 下方的会话浏览器上，选择 平均事务响应时间 。“平均事务响应时间”图将在图查看区域打开。

注： 如果“会话浏览器”窗格中没有显示图，请右键单击“图”节点并在“打开新图”对话框中选择“事务:平均事务响应时间”节点。单击“打开图”可将图添加到“会话浏览器”窗格中。

b. 在“图例”窗格中，单击 check_itinerary 事务。 check_itinerary 事务将在图中突出显示。图上的点代表在场景运行的特定时间内事务的平均时间。将光标放在图中的点上。将会出现一个黄色框并显示该点的坐标值。

2. 分析结果。

请注意， check_itinerary 事务的平均事务时间波动很大，在场景运行2:56分后达到峰值75.067秒。
在运行状况良好的服务器上，事务的平均时间相对稳定。在图的底部，注意 logon 、 logoff 、book_flight 和 search_flight 事务的平均时间相对稳定。

### 服务器的性能是否稳定？

在上一部分，您已看到服务器性能不稳定。现在您将分析 70 个正在运行的Vuser对系统性能的影响。

1. 研究Vuser的行为。
    在 **图** 下方的会话浏览器上，单击 **正在运行的Vuser数** 。将在图查看区域打开 **正在运行的Vuser数**图。

您可以看到在场景开始运行后，Vuser逐渐开始运行。然后 70 个Vuser同时运行了 3 分钟，接着Vuser又开始逐渐停止运行。

2. 筛选该图，仅查看所有Vuser同时运行的时间段。
    筛选图之后，显示的图数据范围将缩小，仅显示符合指定条件的数据。所有其他数据将隐藏。
       a. 右键单击图并选择 **设置筛选/分组方式** ，或者单击Analysis工具栏上的 **设置筛选/分组方式** 按钮 。
    
    b. 在 筛选条件 区域，选择 场景已用时间 行的 值 列。
    c. 单击向下箭头并指定从 000:01:30 （时:分:秒）到 000:03:45 （时:分:秒）的时间范围。
    d. 单击 确定 。
    e. 在“图设置”对话框中单击 确定 。
    正在运行的Vuser数 图现在仅显示场景运行后1:30（分钟:秒）到3:45（分钟:秒）之间运行的Vuser。所有其他Vuser已全部筛选出去。
    
    注： 要清除筛选，请右键单击该图并选择 清除筛选/分组方式 ，或者单击Analysis工具栏上的 清除筛选器和分组方式 按钮 。
    
3. 将“正在运行的Vuser数”图和“平均事务响应时间”图关联在一起来比较数据。将两个图关联起来，就会看到一个图的数据对另一个图的数据产生的影响。这称为关联两个图。例如，可以将“正在运行的Vuser数”图与“平均事务响应时间”图相关联，查看大量Vuser对
    事务平均时间产生的影响。
       a. 右键单击“正在运行的Vuser数”图并选择 **清除筛选/分组方式** 
       b. 右键单击该图并选择 **合并图** 。
       c. 在 **选择要合并的图** 列表中，选择 **平均事务响应时间** 。
       d. 在 **选择合并类型** 中，选择 **关联** ，然后单击 **确定** 。
          现在，“运行的Vuser”图和“平均事务响应时间”图将显示为一个图，即“运行的Vuser-平均事务响应时间”图。

    4. 分析关联后的图。在该图中您可以看到随着Vuser数目的增加， check_itinerary 事务的平均时间也在逐渐延长。换
       句话说就是，随着负载的增加，平均时间也在增加。运行 66 个Vuser时，平均时间会突然急剧拉长。我们称之为测试 弄崩了服务器 。同时运行的Vuser数超过 66 个时，时间会明显开始变长。

### 保存模板

目前为止您已经筛选了一个图并关联了两个图。下次分析场景时，您可能需要使用相同的筛选和合并条件来查看这些图。您可以将合并设置和筛选设置保存为模板，并在其他Analysis会话中使用。
要保存模板，请执行以下操作：

1. 选择 **工具>模板** 。“应用/编辑模板”对话框将打开。
2. 在“模板”窗格中，单击 **新建** 按钮。“添加新模板”对话框将打开。
3. 为模板输入适当的名称并单击 **确定** 。
4. 单击 **保存并关闭** 关闭“应用/编辑模板”对话框。
下次您打开新的Analysis会话并需要使用保存的模板时，请执行以下操作：
1. 选择 **工具>模板** 。“应用/编辑模板”对话框将打开。
2. 从列表中选择模板，然后单击 **保存并关闭** 。

### 如何确定问题的根源？

到目前为止，您已经看到了增加服务器的负载会对 check_itinerary 事务的平均响应时间产生负面影响。您可以进一步查看 check_itinerary 事务的详细信息，了解对系统性能产生负面影响的系统资源。
自动关联工具能够合并所有包含某些数据（这些数据会对check_itinerary 事务的响应时间产生影响）的图，并找出问题的原因。

1. 在图树中，选择 **平均事务响应时间** 图。

查看 check_itinerary 事务，尤其是该事务在已用时间（1分钟到 4 分钟之间）内的情况。平均响应时间几乎是立即开始延长，然后在接近 3 分钟时达到峰值。

2. 筛选“平均事务响应时间”图以便仅显示 **check_itinerary** 事务。
    a. 右键单击该图并选择 **设置筛选/分组方式** 。
    b. 在 **事务名** / **值** 单元中，选择 **check_itinerary** 。
    c. 单击 **确定** 。
      筛选后的图将仅显示 **check_itinerary** 事务。
    
3. 自动关联该图。

    a. 右键单击该图，然后选择 自动关联 。
    b. 在“自动关联”对话框中，确保要关联的度量是 check_itinerary ，通过在框中输入时间或者沿着 已用场景时间 轴将绿色和红色的杆拖至相应的位置，将时间范围设置为从1:20至3:40（分:秒）。

    c. 单击 确定 。
    自动关联的图将在图查看区域中打开。 check_itinerary 事务将突出显示。自动关联的图将用默认的名称命名，即 自动关联的图[1] 。

4. 重命名该图。

   a. 在 图 下方的会话浏览器中，右键单击 自动关联的图[1] ，然后选择 重命名项 。这样就可以编辑图名。
   b. 输入 AutoCorrelated-check_itinerary 并按 Enter ，或者单击Analysis窗口中的任意位置。

5. 分析自动关联的图。
    在图下方的 **图例** 窗格中，从 **图** 列中向下滚动到 **Windows资源：PoolNonpagedBytes和PrivateBytes** 度量。

    在 度量 和 关联匹配 列中，您可以看到这些与内存有关的度量和 check_itinerary 事务的关联匹配超过70%。这意味着在指定的时间间隔内，这些元素的行为与 check_itinerary 事务的行为密切相
    关。由此可以完全断定：当 check_itinerary 事务的响应时间达到峰值时，系统内存资源已不足。


### 还可以收集哪些与场景运行情况相关的其他信息？

除了在Analysis会话启动时出现在图树中的图，您还可以通过显示其他的图来获得有关场景运行情况的其他信息。

1. 单击 **图>添加新图** 。此时将打开“打开新图”对话框，并列出包含数据且可显示的图的类别。

- Vuser。 显示有关Vuser及其状态的信息。
- 错误。 显示错误统计信息。
- 事务。 显示有关事务及其响应时间的数据。
- Web资源。 显示点击次数、吞吐量和连接数据。
- 网页诊断。 显示脚本中每个受监控网页的数据。
- 系统资源。 显示系统资源使用情况数据。

2. 显示新图。
    a. 在“打开新图”对话框中，单击类别旁边的“+”展开该类别。
    b. 选择一个图，然后单击 **打开图** 。
    
    c. 单击 关闭 ，关闭“打开新图”对话框。
    现在可以打开更多图，了解有关场景运行情况的更多信息。

### 如何发布结果？

您可以使用HTML报告或MicrosoftWord报告发布分析结果。报告使用设计者模板创建，并且包括所提供图和数据的解释和图例。
HTML报告HTML报告可以在任何浏览器中打开和查看。
要创建HTML报告，请执行下列操作：

1. 单击 **报告>HTML报告** 。
2. 指定报告的文件名和保存路径。
3. 单击 **保存** 。
    Analysis将创建报告并将其显示在Web浏览器中。注意HTML报告的布局与Analysis会话的布局十分相似。您可以单击左窗格中的链接来查看各个图。页面底部提供关于每幅图的描述。
    **MicrosoftWord报告**
您可以通过MicrosoftWord报告显示Analysis会话。与HTML报告相比，Word报告的内容更全面，因为它可以包含有关场景、度量描述等的常规信息。通过设置报告格式，还可以让它包含贵公司的名称和徽标以及作者的详细信息。
与所有MicrosoftWord文件一样，该报告也可以编辑，因此您可以在生成报告后继续添加注释和结果。
**要创建MicrosoftWord报告，请执行下列操作：**
1. 单击 **报告>新建报告** 。
“新建报告”对话框将打开。

2. 在 常规 选项卡中：

a. 从 基于模板 中选择 详细报告(适用于单个运行) 。
b. 为报告输入标题。
c. 输入作者的姓名、职务以及单位。

3. 在 **格式** 选项卡中：
    默认情况下，生成的报告将有标题页、目录、图详细信息和描述以及度量描述。您可以选择向报告添加脚本详细信息的选项，从而可以查看业务流程步骤的缩略图。可以通过选择 **包括公司徽标** 并浏览到文件所在的位置来包含公司徽标。徽标必须是.bmp文件。
    
4. 在 **内容** 选项卡中：
    a. 选择要包含在报告中的场景运行部分和Analysis会话部分。
       本教程中您会将执行摘要添加到“内容项目”列表中。
    
    b. 单击 添加 按钮 可打开“添加内容项”窗口。选中网格中的 执行摘要 ，并单击 确定 。“执行摘要”项将添加到 内容项 窗格的列表中。
    将以下文字输入到编辑框中：
    
    **- 目标：** 该测试场景的目标是...。
    **- 结论：** 我所得出的结论如下：
    
    c. 在 内容项 窗格中，选择 平均字节数(KB)最大的URL 并单击 删除 按钮 。这样将从报告中排除此图。
    d. 更改项目在报告中显示的顺序。
    
    在 **内容项** 窗格中，选择 **工作负载特性** 。在 **所选列** 列表中单击 **每秒平均点击次数** 。
    
    单击向下箭头直到项目出现在 事务总数 之下。在报告中， 每秒平均点击次数 项将跟随在 事务总数 项之后。
    
    5. 单击 生成 。
    
    收集数据并以Word文件的格式创建报告，该报告将在MicrosoftWord中打开。
    除了Analysis会话期间生成的图，该报告还将包括目标和结论，以及您在生成报告时选择要包含的其他部分和图。

### 结论

在这一课，您学习了定义服务水平协议、分析场景运行情况和以报告的形式发布结果的基础知识。

您已经了解，可以通过研究显示服务器上瓶颈（可能是由于负载过重）的各个图来确定性能问题。您已经了解，通过将这些图配置为显示关联数据可以确定瓶颈的根源。